---
import Layout from "./Layout.astro";
import Container from "../components/ui/Container.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Link from "../components/ui/Link.astro";
import { sampleSize, random } from "lodash-es";

export interface CaseStudyData {
  title: string;
  description: string;
  hero: string;
  highlight: string;
  gradient: string;
  ogImage?: string;
  slug: string;
  metadata: Array<{
    name: string;
    content: string | string[][];
  }>;
}

interface Props {
  data: CaseStudyData;
}

const { data } = Astro.props;

// Generate random avatar and emoji
const emojiList = ["ðŸŒŠ", "ðŸŽ¨", "ðŸŽµ", "ðŸ’»", "ðŸŒˆ", "ðŸŽ­", "ðŸŽª", "ðŸŽ¯", "ðŸŒŸ", "ðŸ”®"];
const symbol = sampleSize(emojiList, Math.ceil(Math.random() * 3)).join("");
const photo = String(random(1, 10)).padStart(2, "0");

// Get user from locals
const user = Astro.locals.user;
---

<Layout
  title={`${data.title} | Charlie Gleason`}
  description={data.description}
  image={data.ogImage}
  symbol={symbol}
  live={false}
>
  <Container variant="wide">
    <Header symbol={symbol} photo={photo} small />
  </Container>

  <img
    src={`/assets/case-studies/${data.slug}/banner.webp`}
    width="1716"
    height="540"
    class="max-w-full mx-auto rounded hidden sm:block shadow-md border-t"
    alt=""
  />

  <Container variant="full">
    <main
      class="sm:border border-neutral-200 dark:border-neutral-700 pb-8 max-sm:pt-16 xl:pb-20 rounded-lg bg-white dark:bg-neutral-900 mx-px shadow-2xl shadow-black/5"
    >
      <div
        class="grid grid-cols-prose-sm sm:grid-cols-prose pt-0 xl:pt-16 pb-2 xl:pb-16 xl:gap-x-8 gap-y-8 rounded-md bg-white dark:bg-neutral-900 relative"
      >
        <div
          class="col-span-full sm:col-span-2 sm:col-start-2 lg:col-span-1 lg:col-start-2 sm:-mt-12 xl:mt-0 xl:-mr-4"
        >
          <img
            src={`/assets/case-studies/${data.slug}/icon.webp`}
            class="rounded-lg shadow-xl w-[84px] aspect-square"
            alt=""
          />
        </div>
        <div
          class="col-span-full sm:col-start-2 sm:col-span-10 xl:col-span-11 sm:space-y-6"
        >
          <Link
            icon="back"
            href="/#case-studies"
            padding="large"
            background={false}
            class="text-sm max-sm:hidden"
          >
            Back to projects
          </Link>
          <hgroup class="font-display text-4xl xl:text-5xl">
            <h1>{data.title}</h1>
            <h2 class="text-neutral-500 dark:text-neutral-400">
              {data.description}
            </h2>
          </hgroup>
        </div>
      </div>

      <div
        class="grid grid-cols-prose-sm sm:grid-cols-prose xl:gap-x-8 gap-y-8 xl:gap-y-16 [&>*]:col-main [&>*]:xl:col-content [&>.full]:sm:col-full [&>.main]:sm:col-main [&>.wide]:sm:col-wide [&>.sidebar]:py-8 [&>.sidebar]:xl:col-sidebar [&>.lg-sidebar]:xl:col-sidebar [&>.lg-sidebar]:xl:ml-4 [&>.content]:xl:col-content [&>.lg-content]:xl:col-lg-content max-w-none [&>.sidebar]:bg-neutral-100 [&>.sidebar]:pb-2 [&>.sidebar]:dark:bg-neutral-800 [&>.sidebar]:px-8 [&>.sidebar]:rounded-lg overflow-hidden pb-2"
      >
        <slot />

        <div class="pt-4">
          <Link
            icon="back"
            background={false}
            href="/#case-studies"
            padding="large"
            class="inline-block not-prose"
          >
            Back to projects
          </Link>
        </div>
      </div>
    </main>
    <div class="max-w-screen-2xl mx-auto lg:px-7">
      <Footer user={user} />
    </div>
  </Container>
</Layout>
